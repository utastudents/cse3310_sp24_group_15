<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Word Search Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>The WordSearchGame</h1>
    <div id="nicknameInput">
        <label for="nickname">Enter your nickname:</label>
        <input type="text" id="nickname">
        <button onclick="joinLobby()">submit</button>
    </div>
    <div id="waitingPlayersList" style="display:none;">
        <h2>Waiting Players:</h2>
        <ul id="playersList"></ul>
        <button onclick="startGame()">Play with 2 Players</button>
    </div>
    <div class="container">
        <div class="buttonTable" id="gameTable" style="display:none;">    
        </div>
        <div class="info">
          <div class="playerInfo" id="playerInfo" style="display:none;">
              <ul class="player1Info" id="player1Info"></ul>
              <ul class="player2Info" id="player2Info"></ul>
          </div>
          <div class="hintTimer" id="hintTimer" style="display:none;">
            <ul>Time until Hint: </ul>
          </div>
          <div class="timer" id="timer">
          </div>
          <div class="wordBank" id="wordBank" style="display:none;">
              <h2 class="wordBank">Word Bank: </h2>
              <ul class="word" onclick="scratchOut(this)" id="w1">word1</ul>
              <ul class="word" onclick="scratchOut(this)" id="w2">word2</ul>
              <ul class="word" onclick="scratchOut(this)" id="w3">word3</ul>
              <ul class="word" onclick="scratchOut(this)" id="w4">word4</ul>
              <ul class="word" onclick="scratchOut(this)" id="w5">word5</ul>
              <ul class="word" onclick="scratchOut(this)" id="w6">word6</ul>
              <ul class="word" onclick="scratchOut(this)" id="w7">word7</ul>
              <ul class="word" onclick="scratchOut(this)" id="w8">word8</ul>
              <ul class="word" onclick="scratchOut(this)" id="w9">word9</ul>
              <ul class="word" onclick="scratchOut(this)" id="w10">word10</ul>
          </div>
        </div>
        
    </div>
    <script >
      var serverUrl;
    serverUrl = "ws://" + window.location.hostname + ":9115";
    // Create the connection with the server
    socket = new WebSocket(serverUrl);

socket.onopen = function(event) {
    console.log("Connection established.");
};

socket.onmessage = function(event) {
    let message = JSON.parse(event.data);
    
    // Check the type of message
    if (message.type === "grid") {
    // Handle array data
    let receivedGridArray = message.data;
    console.log("array received");
    
    // Call makeTable() with the received array
    makeTable(receivedGridArray);
    }   
    if (message.type === "WordList") {
    // Handle array data
    let receivedWordlist = message.data;
    console.log("WordList received");
    
    // Get the word bank element
    const wordBank = document.getElementById("wordBank");

    // Display the word bank element
    wordBank.style.display = "block";

    // Update the word bank content with received word list
    const wordBankList = wordBank.querySelector(".wordBank");
    wordBankList.innerHTML = "Word Bank: ";

    // Get a random index within the range of receivedWordlist
    const randomIndex = Math.floor(Math.random() * receivedWordlist.length);
    const randomWord = receivedWordlist[randomIndex];

    // Extract the first letter of the random word
    const firstLetter = randomWord.charAt(0).toUpperCase(); // Assuming you want the first letter in uppercase
    
    // Now you can use the 'firstLetter' variable for further processing

    // Iterate over the received word list and update the list items
    receivedWordlist.forEach((word, index) => {
        const listItem = wordBank.querySelector(`#w${index + 1}`);
        if (listItem) {
            listItem.textContent = word;
        }
    });

    wordBank.style.display = "none";
}

 
    if (message.type === "waitingPlayers") {
        // Handle waiting players data
        console.log("names");
        let players = message.data;
        displayWaitingPlayers(players);
    }
};
// Set the timer for 5 minutes (in seconds)
const timerDuration = 1 * 60;


// Get the timer element
const timerDisplay = document.getElementById('timer');

function generateRandomWordFromWordBank() {
    const wordBank = document.querySelectorAll(".wordBank .word"); // Select all word elements
    const randomIndex = Math.floor(Math.random() * wordBank.length); // Get a random index
    const randomWordElement = wordBank[randomIndex]; // Select the random word element
    const randomWord = randomWordElement.textContent.trim(); // Get the text content of the selected element
    return randomWord;
}
let previousLetterIndex = null;

// Function to highlight a letter in the game table


function dehighlightAllLettersInGameTable() {
    const gameTable = document.getElementById("gameTable");

    // Check if gameTable exists
    if (gameTable) {
        const cells = gameTable.querySelectorAll("td");

        // Iterate over each cell in the game table
        for (let i = 0; i < cells.length; i++) {
            // Get the button element in the current cell
            const button = cells[i].querySelector("button");
            
            // Clear the color of the button
            if (button && button.style.backgroundColor == "yellow") {

                button.style.backgroundColor = "#f5fffa"; // Clear the color
                
            }
        }
    }
}


// Function to repeat the process of highlighting a letter after the timer
function highlight() {
    const wordBank = document.querySelectorAll(".wordBank .word"); // Select all word elements
    const randomIndex = Math.floor(Math.random() * wordBank.length); // Get a random index
    const randomWordElement = wordBank[randomIndex]; // Select the random word element
    const randomWord = randomWordElement.textContent.trim(); // Get the text content of the selected element

    // Iterate over each letter in the random word and highlight it
    
        const letter = randomWord[0].toUpperCase(); // Convert letter to uppercase
        searchLetterInGameTableAndHighlight(letter); // Highlight the letter in the game table
    

     
}

// Function to search and highlight a letter in the game table
function searchLetterInGameTableAndHighlight(letter) {
    const gameTable = document.getElementById("gameTable");
    dehighlightAllLettersInGameTable();
    // Check if gameTable exists
    if (gameTable) {
        const cells = gameTable.querySelectorAll("td");

        // Iterate over each cell in the game table
        for (let i = 0; i < cells.length; i++) {
            // Get the button element in the current cell
            const button = cells[i].querySelector("button");
            // Get the text content of the button
            const buttonText = button ? button.textContent.trim().toUpperCase() : ''; // Check if button exists

            // Check if the button text matches the provided letter
            if (buttonText === letter) {
                // Highlight the button by changing its color to yellow
                if (button) {
                    button.style.backgroundColor = "yellow";
                }
            }
        }
    }
}

// Example usage:


// Function to start the countdown
function startTimer(duration, display) {
    let timer = duration, minutes, seconds;
    setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);


        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;


        display.textContent = minutes + ":" + seconds;
        if (timer === 0) {
                // Will trigger HINT function from java and reset timer back to 1min
                let timer = duration, minutes, seconds;
                highlight();
                // You can replace the console.log statement with your custom action
            }



        if (--timer < 0) {
            timer = duration;
        }
    }, 1000);
}






function scratchOut(word){
  
  word.classList.toggle('strikethrough');
  
}

function makeTable(gridArray) {
    const gameTable = document.getElementById("gameTable");

    for (var row = 0; row < gridArray.length; row++) {
        const tableRow = document.createElement("tr");

        for (var col = 0; col < gridArray[row].length; col++) {
            const cell = document.createElement("td");
            const button = document.createElement("button");

            // Set the text of the button to the value from the gridArray
            button.textContent = gridArray[row][col];

            button.addEventListener("click", function() {
                button.style.backgroundColor = "red";
            });

            cell.appendChild(button);
            tableRow.appendChild(cell);
        }

        gameTable.appendChild(tableRow);
    }
}



function buttonClick(){

    console.log("Botton ${row} ${col} pressed");

}

function joinLobby() {
    
    let nickname = document.getElementById("nickname").value;
    document.getElementById("nickname").value = '';
    document.getElementById("nicknameInput").style.display = "none";
    document.getElementById("waitingPlayersList").style.display = "block";
    //socket.send(JSON.stringify({ type: "joinLobby", nickname: nickname }));
}

function startGame() {
    startTimer(timerDuration, timerDisplay);
    document.getElementById("waitingPlayersList").style.display = "none";
    document.getElementById("gameTable").style.display = "grid";
    document.getElementById("playerInfo").style.display = "block";
    document.getElementById("wordBank").style.display = "block";
    document.getElementById("hintTimer").style.display = "block";
    document.getElementById("player1Info").textContent = "Player1: SCORE";
    document.getElementById("player2Info").textContent = "Player2: SCORE";
   
    //socket.send(JSON.stringify({ type: "startGame" }));
}

function displayWaitingPlayers(players) {
    try {
        // Check if players is an array
        if (!Array.isArray(players)) {
            throw new TypeError("Players must be an array.");
        }

        // Get the players list element
        let playersList = document.getElementById("playersList");
        
        // Clear the existing player list
        playersList.innerHTML = "";

        // Iterate over each player in the array
        players.forEach(player => {
            // Create a list item for the player
            let listItem = document.createElement("li");
            
            // Set the text content of the list item to the player's name
            listItem.textContent = player;
            
            // Append the list item to the players list
            playersList.appendChild(listItem);
        });
        
        // Hide the nickname input field
        document.getElementById("nicknameInput").style.display = "none";
        
        // Display the waiting players list
        document.getElementById("waitingPlayersList").style.display = "block";
    } catch (error) {
        // Handle any errors that may occur
        console.error("An error occurred while displaying waiting players:", error);
    }
}



    </script>
</body>
</html>
