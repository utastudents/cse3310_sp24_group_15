<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Word Search Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>The WordSearchGame</h1>
    <div id="nicknameInput">
        <label for="nickname">Enter your nickname:</label>
        <input type="text" id="nickname">
        <button onclick="joinLobby()">submit</button>
    </div>
    <div id="waitingPlayersList" style="display:none;">
        <h2>Waiting Players:</h2>
        <ul id="playersList"></ul>
        <button onclick="startGame()">Play with 2 Players</button>
    </div>
    <div class="container">
        <div class="buttonTable" id="gameTable" style="display:none;">    
        </div>
        <div class="info">
          <div class="playerInfo" id="playerInfo" style="display:none;">
              <ul class="player1Info" id="player1Info"></ul>
              <ul class="player2Info" id="player2Info"></ul>
          </div>
  
          <div class="wordBank" id="wordBank" style="display:none;">
              <h2 class="wordBank">Word Bank: </h2>
              <ul class="word" onclick="scratchOut(this)" id="w1">word1</ul>
              <ul class="word" onclick="scratchOut(this)" id="w2">word2</ul>
              <ul class="word" onclick="scratchOut(this)" id="w3">word3</ul>
              <ul class="word" onclick="scratchOut(this)" id="w4">word4</ul>
              <ul class="word" onclick="scratchOut(this)" id="w5">word5</ul>
              <ul class="word" onclick="scratchOut(this)" id="w6">word6</ul>
              <ul class="word" onclick="scratchOut(this)" id="w7">word7</ul>
              <ul class="word" onclick="scratchOut(this)" id="w8">word8</ul>
              <ul class="word" onclick="scratchOut(this)" id="w9">word9</ul>
              <ul class="word" onclick="scratchOut(this)" id="w10">word10</ul>
          </div>
        </div>
        
    </div>
    <script >
      var serverUrl;
    serverUrl = "ws://" + window.location.hostname + ":9880";
    // Create the connection with the server
    socket = new WebSocket(serverUrl);

socket.onopen = function(event) {
    console.log("Connection established.");
};

socket.onmessage = function(event) {
    let message = JSON.parse(event.data);
    
    // Check the type of message
    if (message.type === "grid") {
    // Handle array data
    let receivedGridArray = message.data;
    console.log("array received");
    
    // Call makeTable() with the received array
    makeTable(receivedGridArray);
    }   
    if (message.type === "WordList") {
    // Handle array data
    let receivedWordlist = message.data;
    console.log("WordList received");
    
    // Get the word bank element
    const wordBank = document.getElementById("wordBank");

    // Display the word bank element
    wordBank.style.display = "block";

    // Update the word bank content with received word list
    const wordBankList = wordBank.querySelector(".wordBank");
    wordBankList.innerHTML = "Word Bank: ";

    // Iterate over the received word list and update the list items
    receivedWordlist.forEach((word, index) => {
        const listItem = wordBank.querySelector(`#w${index + 1}`);
        if (listItem) {
            listItem.textContent = word;
        }
    });
}
 
    if (message.type === "waitingPlayers") {
        // Handle waiting players data
        console.log("names");
        let players = message.data;
        displayWaitingPlayers(players);
    }
};



function scratchOut(word){
  
  word.classList.toggle('strikethrough');
  
}

function makeTable(gridArray) {
    const gameTable = document.getElementById("gameTable");

    for (var row = 0; row < gridArray.length; row++) {
        const tableRow = document.createElement("tr");

        for (var col = 0; col < gridArray[row].length; col++) {
            const cell = document.createElement("td");
            const button = document.createElement("button");

            // Set the text of the button to the value from the gridArray
            button.textContent = gridArray[row][col];

            button.addEventListener("click", function() {
                button.style.backgroundColor = "red";
            });

            cell.appendChild(button);
            tableRow.appendChild(cell);
        }

        gameTable.appendChild(tableRow);
    }
}


function buttonClick(){

    console.log("Botton ${row} ${col} pressed");

}

function joinLobby() {
    
    let nickname = document.getElementById("nickname").value;
    document.getElementById("nickname").value = '';
    document.getElementById("nicknameInput").style.display = "none";
    document.getElementById("waitingPlayersList").style.display = "block";
    //socket.send(JSON.stringify({ type: "joinLobby", nickname: nickname }));
}

function startGame() {

    document.getElementById("waitingPlayersList").style.display = "none";
    document.getElementById("gameTable").style.display = "grid";
    document.getElementById("playerInfo").style.display = "block";
    document.getElementById("wordBank").style.display = "block";
    document.getElementById("player1Info").textContent = "Player1: SCORE";
    document.getElementById("player2Info").textContent = "Player2: SCORE";
    makeTable();
    //socket.send(JSON.stringify({ type: "startGame" }));
}

function displayWaitingPlayers(players) {
    try {
        // Check if players is an array
        if (!Array.isArray(players)) {
            throw new TypeError("Players must be an array.");
        }

        // Get the players list element
        let playersList = document.getElementById("playersList");
        
        // Clear the existing player list
        playersList.innerHTML = "";

        // Iterate over each player in the array
        players.forEach(player => {
            // Create a list item for the player
            let listItem = document.createElement("li");
            
            // Set the text content of the list item to the player's name
            listItem.textContent = player;
            
            // Append the list item to the players list
            playersList.appendChild(listItem);
        });
        
        // Hide the nickname input field
        document.getElementById("nicknameInput").style.display = "none";
        
        // Display the waiting players list
        document.getElementById("waitingPlayersList").style.display = "block";
    } catch (error) {
        // Handle any errors that may occur
        console.error("An error occurred while displaying waiting players:", error);
    }
}



    </script>
</body>
</html>
